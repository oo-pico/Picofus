<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Picofus ‚Äì Tracker</title>

  <style>
    :root{
      --bg:#0e0e0f; --panel:#151517; --panel-soft:#1b1b1e; --stroke:#26262a;
      --text:#e6e6e6; --muted:#9a9a9a; --gold:#d6b36a; --gold-soft:#b89a55;
      --bad:#ff4d4d; --good:#45d07a; --shadow:0 12px 30px rgba(0,0,0,.35);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      background:
        radial-gradient(1200px 600px at 30% -10%, rgba(214,179,106,.08), transparent 60%),
        radial-gradient(900px 500px at 110% 10%, rgba(214,179,106,.06), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1150px;margin:0 auto;padding:22px}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:16px;
      padding:14px 16px;border:1px solid var(--stroke);border-radius:var(--r);
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      box-shadow:var(--shadow);
      position:sticky;top:10px;z-index:20;backdrop-filter:blur(10px);
    }
    .brand{display:flex;align-items:center;gap:12px;min-width:0}
    .logo{
      width:38px;height:38px;border-radius:12px;
      background:linear-gradient(135deg, rgba(214,179,106,.35), rgba(214,179,106,.05));
      border:1px solid rgba(214,179,106,.35);
      display:grid;place-items:center;
      font-weight:800;color:var(--gold);
      flex-shrink:0;
    }
    .brand h1{font-size:16px;margin:0;line-height:1;white-space:nowrap}
    .brand p{margin:0;color:var(--muted);font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .nav{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end}

    .btn{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.03);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      display:inline-flex;align-items:center;gap:8px;
      transition:transform .08s ease, border-color .15s ease, background .15s ease;
      user-select:none;
    }
    .btn:hover{border-color:rgba(214,179,106,.45);background:rgba(214,179,106,.07)}
    .btn:active{transform:translateY(1px)}
    .btn.gold{border-color:rgba(214,179,106,.55);background:rgba(214,179,106,.08)}
    .btn.bad{border-color:rgba(255,77,77,.5);background:rgba(255,77,77,.08)}
    .btn.good{border-color:rgba(69,208,122,.5);background:rgba(69,208,122,.08)}
    .btn.small{padding:8px 10px;border-radius:12px;font-size:13px}

    .pill{
      font-size:12px;color:var(--muted);
      border:1px solid var(--stroke);background:rgba(255,255,255,.02);
      padding:7px 10px;border-radius:999px;
      display:inline-flex;align-items:center;gap:8px;
      max-width:360px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    main{padding-top:18px}

    .grid{display:grid;grid-template-columns:repeat(3, minmax(0, 1fr));gap:14px;}
    @media (max-width: 980px){ .grid{grid-template-columns:repeat(2, minmax(0, 1fr))} }
    @media (max-width: 620px){ .grid{grid-template-columns:1fr} }

    .card{
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
      display:flex;gap:14px;align-items:center;justify-content:space-between;
    }
    .card-left{display:flex;gap:12px;align-items:center;min-width:0}
    .thumb{
      width:54px;height:54px;border-radius:16px;
      border:1px solid rgba(214,179,106,.25);
      background:rgba(214,179,106,.06);
      display:grid;place-items:center;overflow:hidden;
      flex-shrink:0;
    }
    .thumb img{width:100%;height:100%;object-fit:contain}
    .card h3{margin:0;font-size:15px}
    .card p{margin:3px 0 0;color:var(--muted);font-size:12px}
    .card-right{display:flex;gap:8px;align-items:center;flex-shrink:0}

    .section{
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
    }
    .topline{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;margin-bottom:12px;}
    .title{display:flex;gap:12px;align-items:center;min-width:0;}
    .title h2{margin:0;font-size:18px}
    .title .sub{margin:0;color:var(--muted);font-size:12px}

    .list{display:flex;flex-direction:column;gap:10px}
    .item{
      display:grid;
      grid-template-columns:42px 1fr auto;
      gap:10px;align-items:center;
      padding:10px;
      border:1px solid var(--stroke);
      border-radius:16px;
      background:rgba(255,255,255,.02);
    }
    .ico{
      width:42px;height:42px;border-radius:14px;
      border:1px solid rgba(214,179,106,.18);
      background:rgba(214,179,106,.05);
      display:grid;place-items:center;overflow:hidden;
    }
    .ico img{width:100%;height:100%;object-fit:contain}
    .name{min-width:0}
    .name .n{font-size:14px;margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .name .m{font-size:12px;margin:2px 0 0;color:var(--muted)}
    .ctrls{display:flex;gap:8px;align-items:center}
    .num{
      min-width:92px;text-align:right;
      font-variant-numeric:tabular-nums;
      font-weight:800;
      padding:8px 10px;border-radius:12px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.18);
      cursor:pointer;
    }

    /* modal */
    .modalBack{
      position:fixed;inset:0;background:rgba(0,0,0,.55);
      display:none;align-items:center;justify-content:center;
      padding:18px;z-index:999;
    }
    .modal{
      width:min(520px, 100%);
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border-radius:18px;
      box-shadow:var(--shadow);
      padding:14px;
    }
    .modalTop{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .modalTop h3{margin:0;font-size:16px}
    .modalTop p{margin:2px 0 0;color:var(--muted);font-size:12px}
    .modalBody{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .input{
      width:100%;
      padding:12px 12px;border-radius:14px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.18);
      color:var(--text);
      font-size:18px;
      font-weight:800;
      font-variant-numeric:tabular-nums;
      outline:none;
    }
    .hint{margin-top:10px;color:var(--muted);font-size:12px}
    .modalBtns{margin-top:12px;display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}
  </style>
</head>

<body>
  <div class="wrap">
    <header id="topHeader">
      <div class="brand">
        <div class="logo">P</div>
        <div style="min-width:0">
          <h1>Picofus</h1>
          <p>Tracker ‚Äî local / cloud</p>
        </div>
      </div>

      <div class="nav">
        <a class="btn small" href="#home">Accueil</a>
        <a class="btn small" href="#donjons">Donjons</a>
        <a class="btn small" href="#omega">Om√©ga</a>

        <span class="pill" id="authPill">local</span>

        <button class="btn small gold" id="btnLogin" type="button">cloud</button>
        <button class="btn small bad" id="btnLogout" type="button" style="display:none">local</button>
      </div>
    </header>

    <main id="app"></main>
  </div>

  <!-- Modal de saisie -->
  <div class="modalBack" id="modalBack" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalTop">
        <div>
          <h3 id="modalTitle">Saisie</h3>
          <p id="modalSub">Entre un nombre</p>
        </div>
        <button class="btn small" id="modalClose" type="button">‚úï</button>
      </div>
      <div class="modalBody">
        <input class="input" id="modalInput" inputmode="numeric" autocomplete="off" />
        <div class="hint">Astuce : tu peux coller un gros nombre. (Seuls les chiffres sont gard√©s)</div>
      </div>
      <div class="modalBtns">
        <button class="btn small" id="modalCancel" type="button">Annuler</button>
        <button class="btn small good" id="modalOk" type="button">OK</button>
      </div>
    </div>
  </div>

  <script>
    /* =========================================================
       CONFIG SUPABASE (optionnel)
       ========================================================= */
const SUPABASE_URL = "https://pktrtwqavqbhdhtzkocy.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_VpU8DwxA2rkt0rAgoeWwiQ_dKL_ubXL";


    let sb = null;        // client supabase (si configur√©)
    let isCloud = false;  // connect√© ?
    let cloudReady = false;

    /* =========================================================
       DATA (exemple Comte + ressources)
       Tu peux ajouter tes autres donjons ensuite.
       ========================================================= */
    const DUNGEONS = [
      {
        id: "comte",
        name: "Comte Harebourg",
        desc: "Compteurs donjon / ressources / kamas",
        thumb: "images/comte/comte.png", // optionnel (si tu as)
        items: [
          { key:"donjons", name:"Donjons", sub:"Total runs", icon:"images/comte/comte.png" },
          { key:"scapula", name:"Scapula du Comte Harebourg", sub:"Drop", icon:"images/comte/scapula.png" },
          { key:"bandelette", name:"Bandelette du Comte Harebourg", sub:"Drop", icon:"images/comte/bandelette.png" },
          { key:"pic", name:"Pic de Noctularbe", sub:"Drop", icon:"images/comte/pic.png" },
          { key:"bec1", name:"Bec de Granduk", sub:"Drop", icon:"images/comte/bec_granduk.png" },
          { key:"bec2", name:"Bec de Strigide", sub:"Drop", icon:"images/comte/bec_strigide.png" },
          { key:"plume", name:"Plume de Cyclo√Øde", sub:"Drop", icon:"images/comte/plume.png" },
        ]
      }
    ];

    /* =========================================================
       STORAGE
       - localStorage toujours
       - cloud (supabase) seulement si connect√©
       ========================================================= */
    const LS_KEY = "picofus_state_v1";

    function loadLocalState(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return {};
        return JSON.parse(raw) || {};
      }catch(e){
        console.error("loadLocalState", e);
        return {};
      }
    }
    function saveLocalState(state){
      localStorage.setItem(LS_KEY, JSON.stringify(state));
    }

    // state = { dungeonId: { counterKey: number, ... }, omega:{cur:..., target:...} }
    let state = loadLocalState();

    function getCounter(dungeonId, key){
      return Number(state?.[dungeonId]?.[key] ?? 0) || 0;
    }
    function setCounter(dungeonId, key, value){
      if(!state[dungeonId]) state[dungeonId] = {};
      state[dungeonId][key] = clampInt(value);
      saveLocalState(state);
      // (cloud sync optionnel: plus tard)
    }
    function incCounter(dungeonId, key, delta){
      const v = getCounter(dungeonId, key) + delta;
      setCounter(dungeonId, key, v);
    }

    function clampInt(v){
      const n = Number(String(v).replace(/[^\d-]/g, "")) || 0;
      return Math.max(0, Math.floor(n));
    }

    /* =========================================================
       ROUTER
       ========================================================= */
    function getRoute(){
      const h = (location.hash || "#home").replace(/^#/, "");
      const parts = h.split("/").filter(Boolean);
      if(parts.length === 0) return { page:"home" };
      if(parts[0] === "home") return { page:"home" };
      if(parts[0] === "donjons") return { page:"donjons" };
      if(parts[0] === "dungeon") return { page:"dungeon", id: parts[1] || "" };
      if(parts[0] === "omega") return { page:"omega" };
      return { page:"home" };
    }

    function navTo(hash){
      location.hash = hash;
    }

    /* =========================================================
       MODAL INPUT (clic sur le nombre)
       ========================================================= */
    const modalBack = document.getElementById("modalBack");
    const modalInput = document.getElementById("modalInput");
    const modalTitle = document.getElementById("modalTitle");
    const modalSub = document.getElementById("modalSub");
    const modalClose = document.getElementById("modalClose");
    const modalCancel = document.getElementById("modalCancel");
    const modalOk = document.getElementById("modalOk");

    let modalResolve = null;

    function openNumberModal(title, sub, initialValue){
      modalTitle.textContent = title || "Saisie";
      modalSub.textContent = sub || "Entre un nombre";
      modalInput.value = String(initialValue ?? "");
      modalBack.style.display = "flex";
      modalBack.setAttribute("aria-hidden", "false");

      setTimeout(()=> modalInput.focus(), 0);

      return new Promise((resolve)=>{
        modalResolve = resolve;
      });
    }

    function closeNumberModal(result){
      modalBack.style.display = "none";
      modalBack.setAttribute("aria-hidden", "true");
      const r = modalResolve;
      modalResolve = null;
      if(r) r(result);
    }

    modalClose.onclick = () => closeNumberModal(null);
    modalCancel.onclick = () => closeNumberModal(null);
    modalOk.onclick = () => closeNumberModal(modalInput.value);

    modalBack.addEventListener("click", (e)=>{
      if(e.target === modalBack) closeNumberModal(null);
    });

    modalInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter") closeNumberModal(modalInput.value);
      if(e.key === "Escape") closeNumberModal(null);
    });

    /* =========================================================
       AUTH UI (LOCAL/CLOUD) ‚Äî SANS EMAIL
       ========================================================= */
    const authPill = document.getElementById("authPill");
    const btnLogin = document.getElementById("btnLogin");
    const btnLogout = document.getElementById("btnLogout");

    function updateAuthUI(){
      // On n'affiche JAMAIS l'email. Juste local/cloud.
      authPill.textContent = isCloud ? "cloud" : "local";
      authPill.title = isCloud ? "Connect√© (cloud)" : "Mode local";

      btnLogin.style.display = isCloud ? "none" : "inline-flex";
      btnLogout.style.display = isCloud ? "inline-flex" : "none";
    }

    /* =========================================================
       SUPABASE (optionnel)
       - si pas configur√©: tout marche en local
       ========================================================= */
    function hasSupabaseConfig(){
      return !!(SUPABASE_URL && SUPABASE_ANON_KEY);
    }

    async function initSupabase(){
      if(!hasSupabaseConfig()){
        cloudReady = false;
        isCloud = false;
        updateAuthUI();
        return;
      }

      // Charger supabase-js via CDN (sans casser le site si √ßa fail)
      try{
        await loadScriptOnce("https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2");
        sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        cloudReady = true;

        // √©tat session
        const { data } = await sb.auth.getSession();
        isCloud = !!data?.session;

        // listener
        sb.auth.onAuthStateChange((_event, session)=>{
          isCloud = !!session;
          updateAuthUI();
        });

        updateAuthUI();
      }catch(e){
        console.error("Supabase init failed:", e);
        sb = null;
        cloudReady = false;
        isCloud = false;
        updateAuthUI();
      }
    }

    function loadScriptOnce(src){
      return new Promise((resolve, reject)=>{
        const existing = document.querySelector(`script[data-src="${src}"]`);
        if(existing) return resolve();
        const s = document.createElement("script");
        s.src = src;
        s.async = true;
        s.dataset.src = src;
        s.onload = ()=> resolve();
        s.onerror = ()=> reject(new Error("Failed to load "+src));
        document.head.appendChild(s);
      });
    }

    btnLogin.onclick = async ()=>{
      // "cloud" = login
      if(!cloudReady || !sb){
        alert("Cloud non configur√©. Ajoute SUPABASE_URL et SUPABASE_ANON_KEY dans le fichier.");
        return;
      }
      // Login simple par magic link
      const email = prompt("Email (non affich√© ensuite) :");
      if(!email) return;

      const { error } = await sb.auth.signInWithOtp({
        email,
        options: { emailRedirectTo: window.location.origin + window.location.pathname + window.location.hash }
      });
      if(error){
        console.error(error);
        alert("Erreur login: " + error.message);
      }else{
        alert("Check ta bo√Æte mail pour te connecter.");
      }
    };

    btnLogout.onclick = async ()=>{
      // "local" = logout
      if(sb && cloudReady){
        await sb.auth.signOut();
      }
      isCloud = false;
      updateAuthUI();
    };

    // callback (magic link)
    async function handleAuthCallback(){
      if(!sb) return;
      const hasCode = window.location.search.includes("code=");
      if(!hasCode) return;

      const { error } = await sb.auth.exchangeCodeForSession(window.location.href);
      if(error) console.error("exchangeCodeForSession error:", error);

      const cleanUrl = window.location.origin + window.location.pathname + window.location.hash;
      window.history.replaceState({}, document.title, cleanUrl);
    }

    /* =========================================================
       RENDER
       ========================================================= */
    const app = document.getElementById("app");

    function renderHome(){
      app.innerHTML = `
        <div class="section">
          <div class="topline">
            <div class="title">
              <div>
                <h2>Accueil</h2>
                <p class="sub">Ton tracker farm ‚Äî simple, rapide, propre.</p>
              </div>
            </div>
          </div>

          <div class="grid" style="margin-top:10px">
            <div class="card">
              <div class="card-left">
                <div class="thumb">üè∞</div>
                <div style="min-width:0">
                  <h3>Donjons</h3>
                  <p>Compteurs, drops, kamas‚Ä¶</p>
                </div>
              </div>
              <div class="card-right">
                <button class="btn small gold" onclick="location.hash='#donjons'">Ouvrir</button>
              </div>
            </div>

            <div class="card">
              <div class="card-left">
                <div class="thumb">‚ö°</div>
                <div style="min-width:0">
                  <h3>Om√©ga</h3>
                  <p>Outil simple (placeholder propre).</p>
                </div>
              </div>
              <div class="card-right">
                <button class="btn small gold" onclick="location.hash='#omega'">Ouvrir</button>
              </div>
            </div>

            <div class="card">
              <div class="card-left">
                <div class="thumb">‚òÅÔ∏è</div>
                <div style="min-width:0">
                  <h3>Statut</h3>
                  <p>${isCloud ? "cloud (connect√©)" : "local (d√©connect√©)"}</p>
                </div>
              </div>
              <div class="card-right">
                <span class="pill">${isCloud ? "cloud" : "local"}</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderDonjons(){
      const cards = DUNGEONS.map(d => `
        <div class="card">
          <div class="card-left">
            <div class="thumb">
              ${d.thumb ? `<img src="${d.thumb}" alt="">` : "üè∞"}
            </div>
            <div style="min-width:0">
              <h3>${escapeHtml(d.name)}</h3>
              <p>${escapeHtml(d.desc)}</p>
            </div>
          </div>
          <div class="card-right">
            <button class="btn small gold" onclick="location.hash='#dungeon/${d.id}'">Ouvrir</button>
          </div>
        </div>
      `).join("");

      app.innerHTML = `
        <div class="section">
          <div class="topline">
            <div class="title">
              <div>
                <h2>Donjons</h2>
                <p class="sub">Choisis un projet.</p>
              </div>
            </div>
          </div>
          <div class="grid">${cards}</div>
        </div>
      `;
    }

    function renderDungeon(id){
      const d = DUNGEONS.find(x => x.id === id);
      if(!d){
        app.innerHTML = `
          <div class="section">
            <h2>Donjon introuvable</h2>
            <p class="sub">Retour.</p>
            <div style="margin-top:10px">
              <button class="btn small gold" onclick="location.hash='#donjons'">Donjons</button>
            </div>
          </div>
        `;
        return;
      }

      const list = d.items.map(it=>{
        const v = getCounter(d.id, it.key);
        return `
          <div class="item">
            <div class="ico">${it.icon ? `<img src="${it.icon}" alt="">` : "‚Ä¢"}</div>
            <div class="name">
              <p class="n">${escapeHtml(it.name)}</p>
              <p class="m">${escapeHtml(it.sub || "")}</p>
            </div>
            <div class="ctrls">
              <button class="btn small" onclick="window.__dec('${d.id}','${it.key}')">-</button>
              <div class="num" title="Clique pour saisir" onclick="window.__set('${d.id}','${it.key}', ${v})">${formatInt(v)}</div>
              <button class="btn small" onclick="window.__inc('${d.id}','${it.key}')">+</button>
            </div>
          </div>
        `;
      }).join("");

      app.innerHTML = `
        <div class="section">
          <div class="topline">
            <div class="title">
              <div>
                <h2>${escapeHtml(d.name)}</h2>
                <p class="sub">Clique sur un nombre pour saisir direct.</p>
              </div>
            </div>
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <button class="btn small" onclick="location.hash='#donjons'">‚Üê Donjons</button>
              <button class="btn small bad" onclick="window.__resetDungeon('${d.id}')">Reset</button>
            </div>
          </div>

          <div class="list">${list}</div>
        </div>
      `;
    }

    function renderOmega(){
      // Placeholder propre (tu pourras recoller ton calcul omega plus tard sans casser le CSS)
      const cur = Number(state?.omega?.cur ?? 0) || 0;
      const target = Number(state?.omega?.target ?? 0) || 0;

      app.innerHTML = `
        <div class="section">
          <div class="topline">
            <div class="title">
              <div>
                <h2>Om√©ga</h2>
                <p class="sub">Saisie directe. (Tu me redonneras ton bloc calcul si tu veux remettre le mod√®le complet.)</p>
              </div>
            </div>
          </div>

          <div class="list">
            <div class="item">
              <div class="ico">‚ö°</div>
              <div class="name">
                <p class="n">Om√©ga actuel</p>
                <p class="m">Clique sur le nombre pour saisir</p>
              </div>
              <div class="ctrls">
                <div class="num" onclick="window.__setOmega('cur', ${cur})">${formatInt(cur)}</div>
              </div>
            </div>

            <div class="item">
              <div class="ico">üéØ</div>
              <div class="name">
                <p class="n">Om√©ga cible</p>
                <p class="m">Clique sur le nombre pour saisir</p>
              </div>
              <div class="ctrls">
                <div class="num" onclick="window.__setOmega('target', ${target})">${formatInt(target)}</div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function render(){
      updateAuthUI();
      const r = getRoute();
      if(r.page === "home") return renderHome();
      if(r.page === "donjons") return renderDonjons();
      if(r.page === "dungeon") return renderDungeon(r.id);
      if(r.page === "omega") return renderOmega();
      return renderHome();
    }

    /* =========================================================
       ACTIONS GLOBALS (pour onclick)
       ========================================================= */
    window.__inc = (d,k)=>{ incCounter(d,k, +1); render(); };
    window.__dec = (d,k)=>{ incCounter(d,k, -1); render(); };

    window.__set = async (d,k,current)=>{
      const val = await openNumberModal("Saisie", "Entre un nombre", current);
      if(val === null) return;
      setCounter(d,k, val);
      render();
    };

    window.__resetDungeon = (d)=>{
      if(!confirm("Reset tous les compteurs de ce donjon ?")) return;
      state[d] = {};
      saveLocalState(state);
      render();
    };

    window.__setOmega = async (key, current)=>{
      const val = await openNumberModal("Om√©ga", key === "cur" ? "Om√©ga actuel" : "Om√©ga cible", current);
      if(val === null) return;
      if(!state.omega) state.omega = {};
      state.omega[key] = clampInt(val);
      saveLocalState(state);
      render();
    };

    /* =========================================================
       HELPERS
       ========================================================= */
    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function formatInt(n){
      const x = Number(n) || 0;
      return x.toLocaleString("fr-FR");
    }

    /* =========================================================
       BOOT
       ========================================================= */
    window.addEventListener("hashchange", render);

    (async function boot(){
      try{
        await initSupabase();
        if(sb) await handleAuthCallback();
        render();
      }catch(e){
        console.error(e);
        render();
      }
    })();
  </script>
</body>
</html>
